<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCLEX Ultimate V4</title>
    <style>
        :root {
            --primary: #008080;  /* Teal - NEW COLOR so you know it changed */
            --secondary: #20B2AA;
            --accent: #9370DB;
            --success: #27ae60;
            --error: #c0392b;
            --dark: #2c3e50;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #e0f2f1; color: var(--dark); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .app-container { background: white; width: 100%; max-width: 900px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; margin-bottom: 50px; }
        header { background: var(--primary); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .badge { background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; }
        .view { padding: 30px; display: none; animation: fadeIn 0.4s ease; }
        .view.active { display: block; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .menu-card { background: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .menu-card:hover { transform: translateY(-3px); border-color: var(--secondary); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .progress-container { height: 8px; background: #eee; width: 100%; }
        .progress-fill { height: 100%; background: var(--secondary); width: 0%; transition: width 0.3s; }
        .question-text { font-size: 1.25rem; font-weight: 600; margin: 20px 0; line-height: 1.5; }
        .option-btn { background: white; border: 2px solid #bdc3c7; padding: 15px; border-radius: 8px; text-align: left; font-size: 1rem; cursor: pointer; width: 100%; margin-bottom: 10px; transition: all 0.2s; }
        .option-btn:hover:not(:disabled) { border-color: var(--secondary); background: #e0f7fa; }
        .option-btn.correct { background: #d4edda !important; border-color: var(--success) !important; color: #155724; }
        .option-btn.wrong { background: #f8d7da !important; border-color: var(--error) !important; color: #721c24; }
        .rationale { background: #e8f4fd; border-left: 6px solid var(--secondary); padding: 15px; margin-top: 20px; border-radius: 4px; display: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-top: 20px; }
        .btn:hover { background: var(--secondary); }
        .score-box { text-align: center; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .score-number { font-size: 3rem; font-weight: bold; color: var(--primary); display: block; }
        .rundown-item { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; padding: 15px; background: white; border-left: 6px solid #ccc; }
        .rundown-item.correct { border-left-color: var(--success); }
        .rundown-item.wrong { border-left-color: var(--error); }
        .controls-area { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; background: #f1f1f1; padding: 15px; border-radius: 8px; border-left: 5px solid var(--accent); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1 id="header-title">NCLEX Ultimate V4</h1>
        <div class="badge" id="topic-badge">Menu</div>
    </header>

    <div id="view-menu" class="view active">
        <div class="controls-area">
            <input type="checkbox" id="randomize-toggle" checked style="transform: scale(1.5);">
            <label for="randomize-toggle"><strong>Randomize Order?</strong> (Questions will shuffle every time)</label>
        </div>

        <div class="menu-grid">
            <div class="menu-card" onclick="startQuiz('gi')">
                <span style="font-size:3rem;">ü©∫</span>
                <h3>GI Disorders</h3>
                <p>100 Questions</p>
                <p style="color:#777; font-size:0.9rem;">GERD, IBD, Liver, Pancreas</p>
            </div>
            <div class="menu-card" onclick="startQuiz('psych')">
                <span style="font-size:3rem;">üß†</span>
                <h3>Psychiatric & Neuro</h3>
                <p>80 Questions</p>
                <p style="color:#777; font-size:0.9rem;">Meds, Neuroanatomy, Legal</p>
            </div>
        </div>
    </div>

    <div id="view-quiz" class="view">
        <div class="progress-container"><div class="progress-fill" id="progress-fill"></div></div>
        <div style="margin-top:10px; color:#666; font-size:0.9rem; display:flex; justify-content:space-between;">
            <span>Question <span id="q-current">1</span> of <span id="q-total">10</span></span>
            <span id="score-tracker" style="font-weight:bold; color:var(--primary);">Score: 0</span>
        </div>
        
        <div class="question-text" id="question-text"></div>
        <div id="options-container"></div>
        
        <div class="rationale" id="rationale-display">
            <strong>Rationale:</strong> <span id="rationale-text"></span>
        </div>
        
        <div style="text-align:right;">
            <button class="btn" id="btn-next" onclick="nextQuestion()" style="display:none;">Next Question ‚ûú</button>
        </div>
    </div>

    <div id="view-results" class="view">
        <div class="score-box">
            <h2>Exam Complete</h2>
            <span class="score-number"><span id="final-score">0</span>%</span>
            <p id="final-stats">You answered X out of Y correctly.</p>
            <button class="btn" onclick="showMenu()" style="background:transparent; border:2px solid var(--primary); color:var(--primary);">Return to Menu</button>
        </div>

        <h3>Question Breakdown:</h3>
        <div id="rundown-container"></div>
        
        <div style="text-align:center; margin-top:30px;">
            <button class="btn" onclick="window.scrollTo(0,0); showMenu();">Take Another Quiz</button>
        </div>
    </div>
</div>

<script>
    // ================= FULL DATASETS =================
    
    // 80 Psych Questions (Includes the new Neuro ones)
    const psychQuestions = [
        { q: "Client with Schizophrenia on Haloperidol has high fever (39.5¬∞C), rigidity, tachycardia. Priority?", options: ["Give Benztropine.", "Hold med & notify provider.", "Document.", "Give acetaminophen."], answer: 1, rationale: "Signs of Neuroleptic Malignant Syndrome (NMS)." },
        { q: "Client on Phenelzine (MAOI) eats pepperoni pizza. Concern?", options: ["Sodium toxicity.", "Diarrhea.", "Hypertensive Crisis.", "Allergy."], answer: 2, rationale: "Tyramine interaction causes hypertensive crisis." },
        { q: "Lithium client has diarrhea, tremors, level 1.6. Interpretation?", options: ["Sub-therapeutic.", "Therapeutic.", "Toxic.", "Expected."], answer: 2, rationale: "Level >1.5 with GI signs is toxic." },
        { q: "Clozapine monitoring requirement?", options: ["Liver enzymes.", "WBC & ANC.", "Creatinine.", "Glucose."], answer: 1, rationale: "Risk of Agranulocytosis." },
        { q: "Lithium client wants low-sodium diet. Response?", options: ["Good for heart.", "Causes toxicity.", "Increase sodium.", "No effect."], answer: 1, rationale: "Low sodium causes Lithium retention." },
        { q: "NOT a symptom of EPS?", options: ["Akathisia.", "Dystonia.", "Pseudoparkinsonism.", "High fever."], answer: 3, rationale: "High fever is NMS." },
        { q: "Alprazolam discharge teaching?", options: ["Take with wine.", "Stop if sleepy.", "Do not drive.", "Takes 4 weeks."], answer: 2, rationale: "Sedation safety." },
        { q: "Fluoxetine causing jitteriness?", options: ["Common transient side effect.", "Allergy.", "Stop med.", "Take at night."], answer: 0, rationale: "Common in first weeks." },
        { q: "ECT teaching needs correction:", options: ["Anesthesia used.", "Memory loss risk.", "Cures forever.", "Consent needed."], answer: 2, rationale: "Not a permanent cure." },
        { q: "Therapeutic response to 'I'm terrible':", options: ["Why?", "You aren't.", "You feel hopeless.", "Distraction."], answer: 2, rationale: "Reflection." },
        { q: "Orientation Phase goal:", options: ["Insight.", "Trust & Contract.", "Resistance.", "Evaluation."], answer: 1, rationale: "Rapport building." },
        { q: "Suicidal ideation priority:", options: ["Precautions.", "Journaling.", "Gratitude.", "Meds."], answer: 0, rationale: "Safety." },
        { q: "Personal question response:", options: ["Answer.", "Ask why.", "Redirect.", "Lie."], answer: 2, rationale: "Boundaries." },
        { q: "'You are like my mother':", options: ["Countertransference.", "Transference.", "Resistance.", "Violation."], answer: 1, rationale: "Displacement onto nurse." },
        { q: "Non-therapeutic response:", options: ["Pros/Cons.", "I think you should...", "Difficult decision.", "How does it feel?"], answer: 1, rationale: "Giving advice." },
        { q: "Yelling at sibling after failure:", options: ["Projection.", "Displacement.", "Reaction Formation.", "Sublimation."], answer: 1, rationale: "Shifting target." },
        { q: "NOT Mental Health criteria:", options: ["Reality.", "Autonomy.", "Absence of stress.", "Mastery."], answer: 2, rationale: "Stress is normal." },
        { q: "Maslow priority:", options: ["Spiritual.", "Safety.", "Food/Sleep.", "Esteem."], answer: 2, rationale: "Physiological." },
        { q: "Bedwetting regression:", options: ["Repression.", "Regression.", "Reaction Formation.", "Displacement."], answer: 1, rationale: "Earlier stage." },
        { q: "Typhoon crisis type:", options: ["Maturational.", "Situational.", "Adventitious.", "Internal."], answer: 2, rationale: "Disaster." },
        { q: "Erikson 75y/o:", options: ["Intimacy.", "Generativity.", "Integrity vs Despair.", "Identity."], answer: 2, rationale: "Late adulthood." },
        { q: "Guilt inducing personality:", options: ["Id.", "Ego.", "Superego.", "Conscious."], answer: 2, rationale: "Conscience." },
        { q: "Organizing cards (9y/o):", options: ["Sensorimotor.", "Preoperational.", "Concrete Operational.", "Formal."], answer: 2, rationale: "Logic/Classification." },
        { q: "Boasting member:", options: ["Monopolizer.", "Recognition Seeker.", "Harmonizer.", "Gatekeeper."], answer: 1, rationale: "Attention seeking." },
        { q: "Focusing on third party:", options: ["Enmeshment.", "Triangulation.", "Scapegoating.", "Double Bind."], answer: 1, rationale: "Reducing tension." },
        { q: "Gradual exposure:", options: ["Flooding.", "Aversion.", "Systematic Desensitization.", "Modeling."], answer: 2, rationale: "Phobia treatment." },
        { q: "Nausea with alcohol drug:", options: ["Desensitization.", "Flooding.", "Aversion.", "Operant."], answer: 2, rationale: "Negative pairing." },
        { q: "Identified Patient:", options: ["Cause.", "Healthy.", "Symptom bearer.", "Only patient."], answer: 2, rationale: "Family dysfunction symptom." },
        { q: "Mental Health Act:", options: ["RA 9165.", "RA 11036.", "RA 7160.", "RA 10354."], answer: 1, rationale: "RA 11036." },
        { q: "Stress seminar level:", options: ["Primary.", "Secondary.", "Tertiary.", "Rehab."], answer: 0, rationale: "Prevention." },
        { q: "Impulsivity lobe:", options: ["Parietal.", "Temporal.", "Frontal.", "Occipital."], answer: 2, rationale: "Personality/Executive function." },
        { q: "Emotional brain:", options: ["Cerebellum.", "Limbic System.", "RAS.", "Brain Stem."], answer: 1, rationale: "Emotions/Memory." },
        { q: "Balance/Coordination:", options: ["Cerebellum.", "Hypothalamus.", "Thalamus.", "Pons."], answer: 0, rationale: "Voluntary movement." },
        { q: "Schizophrenia hypothesis:", options: ["Low Ach.", "High Dopamine.", "High Serotonin.", "High GABA."], answer: 1, rationale: "Dopamine excess." },
        { q: "SSRI action:", options: ["Increase Serotonin.", "Block Serotonin.", "Destroy Serotonin.", "Mimic Dopamine."], answer: 0, rationale: "Blocks reuptake." },
        { q: "Inhibitory neurotransmitter:", options: ["Glutamate.", "NE.", "GABA.", "Histamine."], answer: 2, rationale: "Calming." },
        { q: "PET vs CT:", options: ["Magnets.", "Function vs Structure.", "Cost.", "None."], answer: 1, rationale: "PET shows physiology." },
        { q: "Antidepressant delay:", options: ["Neuroplasticity.", "First-pass.", "Receptor adaptation.", "BBB."], answer: 2, rationale: "Downregulation." },
        { q: "Frontal stroke:", options: ["Hearing.", "Vision.", "Judgment/Impulse.", "Sensation."], answer: 2, rationale: "Personality." },
        { q: "Astereognosis lobe:", options: ["Parietal.", "Occipital.", "Temporal.", "Frontal."], answer: 0, rationale: "Tactile processing." },
        { q: "Auditory hallucinations:", options: ["Occipital.", "Temporal.", "Cerebellum.", "Stem."], answer: 1, rationale: "Auditory cortex." },
        { q: "Cortical blindness:", options: ["Frontal.", "Parietal.", "Temporal.", "Occipital."], answer: 3, rationale: "Visual center." },
        { q: "Vital signs instability:", options: ["Brain Stem.", "Corpus Callosum.", "Hippocampus.", "Thalamus."], answer: 0, rationale: "Medulla." },
        { q: "Locus Coeruleus:", options: ["Serotonin.", "Dopamine.", "Norepinephrine.", "Ach."], answer: 2, rationale: "Stress response." },
        { q: "Parkinson's site:", options: ["Substantia Nigra.", "Amygdala.", "Hypothalamus.", "Wernicke."], answer: 0, rationale: "Dopamine source." },
        { q: "Hypothalamus:", options: ["Memory.", "Homeostasis.", "Logic.", "Muscle."], answer: 1, rationale: "Drives/Temp." },
        { q: "New memories:", options: ["Amygdala.", "Hippocampus.", "Thalamus.", "Cingulate."], answer: 1, rationale: "Encoding." },
        { q: "MRI contraindication:", options: ["Shellfish.", "Pacemaker.", "Lithium.", "Claustrophobia."], answer: 1, rationale: "Metal." },
        { q: "Donepezil action:", options: ["Dopamine.", "Serotonin.", "Acetylcholine.", "GABA."], answer: 2, rationale: "For Alzheimer's." },
        { q: "Reward pathway:", options: ["Dopamine.", "Histamine.", "Glutamate.", "Substance P."], answer: 0, rationale: "Pleasure." },
        { q: "Fight/Flight med:", options: ["GABA.", "Norepinephrine.", "Serotonin.", "Endorphins."], answer: 1, rationale: "Arousal." },
        { q: "Excitotoxicity:", options: ["GABA.", "Glutamate.", "Serotonin.", "Dopamine."], answer: 1, rationale: "Excess excitation." },
        { q: "Reuptake:", options: ["New chem.", "Return to sender.", "Destroy.", "Bind."], answer: 1, rationale: "Recycling." },
        { q: "Low Serotonin:", options: ["Schizophrenia.", "Mania.", "Depression.", "ADHD."], answer: 2, rationale: "Mood." },
        { q: "Blood Brain Barrier:", options: ["Prevent blood.", "Protect from toxins.", "CSF.", "Connect."], answer: 1, rationale: "Filter." },
        { q: "Monoamines:", options: ["Dopamine/Serotonin/NE.", "GABA.", "Glutamate.", "Ach."], answer: 0, rationale: "Class." },
        { q: "Sensitization:", options: ["More responsive.", "Destroy.", "Block.", "Mimic."], answer: 0, rationale: "Up-regulation." },
        { q: "Neuroplasticity:", options: ["Static.", "Hardening.", "Reorganization.", "Breakdown."], answer: 2, rationale: "New connections." },
        { q: "Taper meds:", options: ["Rebound.", "Refills.", "Antibiotic.", "Retention."], answer: 0, rationale: "Withdrawal." },
        { q: "Half-life:", options: ["Strength.", "Frequency.", "Weight.", "Cost."], answer: 1, rationale: "Dosing schedule." },
        { q: "Black Box:", options: ["Illegal.", "Generic.", "Serious Risk.", "Adults."], answer: 2, rationale: "FDA warning." },
        { q: "Depot injection:", options: ["Fast.", "Steady 2-4 wks.", "No SE.", "Home."], answer: 1, rationale: "Compliance." },
        { q: "Torticollis:", options: ["Akathisia.", "Dystonia.", "Tardive.", "NMS."], answer: 1, rationale: "Muscle spasm." },
        { q: "Akathisia:", options: ["Sleep.", "Restlessness.", "Tremor.", "Lip smack."], answer: 1, rationale: "Pacing." },
        { q: "Irreversible SE:", options: ["Dystonia.", "Pseudoparkinsonism.", "Tardive Dyskinesia.", "Dry mouth."], answer: 2, rationale: "Permanent." },
        { q: "Atypical antipsychotics:", options: ["Cheaper.", "Dopamine & Serotonin.", "Serotonin.", "No SE."], answer: 1, rationale: "Dual action." },
        { q: "Olanzapine risk:", options: ["Metabolic.", "Anorexia.", "Hypothyroid.", "Renal."], answer: 0, rationale: "Weight gain." },
        { q: "MAOI + Decongestant:", options: ["Drowsy.", "HTN Crisis.", "Cancel.", "Diarrhea."], answer: 1, rationale: "Interaction." },
        { q: "TCA suicide risk:", options: ["Ineffective.", "Cardiac toxicity.", "Insomnia.", "Cost."], answer: 1, rationale: "Lethal OD." },
        { q: "Lithium metal taste:", options: ["Toxic.", "Expected.", "Allergy.", "Low dose."], answer: 1, rationale: "Common SE." },
        { q: "Valproic Acid monitor:", options: ["Liver.", "Thyroid.", "Kidney.", "Calcium."], answer: 0, rationale: "Hepatotoxicity." },
        { q: "Lamotrigine rash:", options: ["Lotion.", "Stop/ER.", "Antihistamine.", "Double."], answer: 1, rationale: "SJS." },
        { q: "Benzos increase:", options: ["Dopamine.", "Glutamate.", "GABA.", "NE."], answer: 2, rationale: "Inhibitory." },
        { q: "Benzo withdrawal:", options: ["Sleep.", "Seizures.", "Weight.", "Dry mouth."], answer: 1, rationale: "Fatal risk." },
        { q: "Non-stimulant ADHD:", options: ["Ritalin.", "Adderall.", "Strattera.", "Modafinil."], answer: 2, rationale: "NRI." },
        { q: "Ritalin weight loss:", options: ["Liquid.", "After meals.", "Stop.", "Bedtime."], answer: 1, rationale: "Appetite suppression." },
        { q: "Alcohol + Antidepressant:", options: ["Blocks.", "Potentiates sedation.", "Vomit.", "Better."], answer: 1, rationale: "CNS depression." },
        { q: "Pharmacogenomics:", options: ["Diagnose.", "Predict metabolism.", "IQ.", "Cure."], answer: 1, rationale: "Enzyme variants." }
    ];

    // 100 GI Questions
    const giQuestions = [
        { q: "PUD patient: rigid abdomen, shoulder pain. Priority?", options: ["Antacid.", "High-Fowler.", "Notify Provider.", "Diet history."], answer: 2, rationale: "Perforation/Peritonitis." },
        { q: "GERD teaching correction:", options: ["Wait 2hr to sleep.", "Small meals.", "Peppermint tea.", "Elevate bed."], answer: 2, rationale: "Peppermint relaxes LES." },
        { q: "Dumping syndrome (dizzy/sweating) intervention:", options: ["Fluids.", "Carbs.", "Lie down.", "More carbs."], answer: 2, rationale: "Slows emptying." },
        { q: "Duodenal ulcer pain timing:", options: ["Immediate.", "30-60m.", "2-3hr/Night.", "Flat."], answer: 2, rationale: "Empty stomach." },
        { q: "H. pylori regimen:", options: ["PPI+H2.", "Triple Therapy.", "Sucralfate.", "Amoxicillin."], answer: 1, rationale: "2 Abx + PPI." },
        { q: "RLQ pain on LLQ palpation:", options: ["Psoas.", "Rovsing.", "Obturator.", "Rebound."], answer: 1, rationale: "Appendicitis sign." },
        { q: "Appendicitis contraindication:", options: ["NPO.", "Ice.", "Enema.", "IVF."], answer: 2, rationale: "Rupture risk." },
        { q: "Acute Diverticulitis diet:", options: ["High fiber.", "NPO/Clear.", "Low fat.", "Full liq."], answer: 1, rationale: "Bowel rest." },
        { q: "Peritonitis priority:", options: ["Dehydration.", "Sepsis.", "Ileus.", "Pain."], answer: 1, rationale: "Shock risk." },
        { q: "Diverticulitis location:", options: ["RUQ.", "LUQ.", "RLQ.", "LLQ."], answer: 3, rationale: "Sigmoid." },
        { q: "UC characteristic:", options: ["Steatorrhea.", "Bloody diarrhea.", "Cobblestone.", "Fistula."], answer: 1, rationale: "Mucosal bleeding." },
        { q: "Crohn's fistula diet:", options: ["Low cal.", "High cal/prot.", "Fiber.", "Fluid restrict."], answer: 1, rationale: "Healing." },
        { q: "IBD anti-inflammatory:", options: ["Sulfasalazine.", "Omeprazole.", "Lactulose.", "Reglan."], answer: 0, rationale: "5-ASA." },
        { q: "Toxic Megacolon:", options: ["Hyperactive.", "Bradycardia.", "Distension/Absent.", "Bleeding."], answer: 2, rationale: "Paralysis." },
        { q: "Early obstruction sound:", options: ["Absent.", "Tinkling.", "Dull.", "Rub."], answer: 1, rationale: "Hyper-peristalsis." },
        { q: "Vomiting electrolyte:", options: ["Hyperkalemia.", "Hypokalemia.", "Hypercal.", "Hypomag."], answer: 1, rationale: "Loss of K." },
        { q: "Obstruction priority:", options: ["Laxative.", "Fiber.", "NG Tube.", "Supine."], answer: 2, rationale: "Decompression." },
        { q: "High Ammonia med:", options: ["Vit K.", "Lactulose.", "Lasix.", "Beta blocker."], answer: 1, rationale: "Excretion." },
        { q: "Asterixis check:", options: ["Babinski.", "Extend arms.", "Liver palp.", "Skin."], answer: 1, rationale: "Flapping tremor." },
        { q: "Sengstaken safety:", options: ["Extra tube.", "Scissors.", "Saline.", "Clamp."], answer: 1, rationale: "Airway block." },
        { q: "Paracentesis prep:", options: ["Water.", "Void.", "NPO.", "Flat."], answer: 1, rationale: "Bladder safety." },
        { q: "Cirrhosis bleed lab:", options: ["Ammonia.", "Albumin.", "PT/INR.", "ALT."], answer: 2, rationale: "Clotting factors." },
        { q: "RUQ pain after fatty food:", options: ["Pancreatitis.", "Cholecystitis.", "Ulcer.", "Appy."], answer: 1, rationale: "Gallbladder." },
        { q: "Stop breathing RUQ palp:", options: ["Cullen.", "Murphy.", "McBurney.", "Turner."], answer: 1, rationale: "Cholecystitis." },
        { q: "Shoulder pain post-lap:", options: ["Position.", "CO2 gas.", "Heart.", "Nerve."], answer: 1, rationale: "Phrenic nerve." },
        { q: "T-Tube care:", options: ["High.", "1000ml.", "Clamp.", "Low."], answer: 3, rationale: "Gravity." },
        { q: "Pancreatitis specific lab:", options: ["Amylase.", "Lipase.", "Bili.", "WBC."], answer: 1, rationale: "Specific." },
        { q: "Trousseau sign:", options: ["Hyperkal.", "Hypocalcemia.", "Hyperglyc.", "Hypernat."], answer: 1, rationale: "Fat binding." },
        { q: "Acute Pancreatitis diet:", options: ["Fat.", "NPO.", "Protein.", "Clears."], answer: 1, rationale: "Rest." },
        { q: "Umbilical bruise:", options: ["Grey Turner.", "Cullen.", "Rovsing.", "Homan."], answer: 1, rationale: "Bleed." },
        { q: "Colonoscopy prep:", options: ["Meal.", "Red dye.", "GoLYTELY.", "Meds."], answer: 2, rationale: "Cleanse." },
        { q: "Liver biopsy pos:", options: ["Supine.", "Left.", "Right.", "High Fowler."], answer: 2, rationale: "Pressure." },
        { q: "Post-EGD check:", options: ["Gas.", "Gag.", "Sounds.", "Alert."], answer: 1, rationale: "Aspiration." },
        { q: "FOBT avoid:", options: ["Chicken.", "Rice.", "Red Meat.", "Milk."], answer: 2, rationale: "False positive." },
        { q: "Post-hemorrhoidectomy:", options: ["Antidiarrheal.", "Softener.", "Enema.", "Protein."], answer: 1, rationale: "No straining." },
        { q: "Sitz bath temp:", options: ["Boil.", "Warm.", "Soap.", "Ice."], answer: 1, rationale: "Comfort." },
        { q: "Bulking laxative:", options: ["Irritate.", "Draw water.", "Absorb/Mass.", "Lube."], answer: 2, rationale: "Fiber." },
        { q: "Cirrhosis vomiting blood:", options: ["Ulcer.", "Varices.", "Hemorrhoid.", "Gastritis."], answer: 1, rationale: "Portal HTN." },
        { q: "B12 for gastritis:", options: ["Appetite.", "Intrinsic Factor.", "Constipation.", "H pylori."], answer: 1, rationale: "Pernicious anemia." },
        { q: "Diarrhea acid-base:", options: ["Resp Acid.", "Met Alk.", "Met Acid.", "Resp Alk."], answer: 2, rationale: "Base loss." },
        { q: "Vagotomy:", options: ["Remove.", "Decrease acid.", "Emptying.", "Repair."], answer: 1, rationale: "Cut nerve." },
        { q: "Diverticulitis perforation:", options: ["Constipation.", "Cramp.", "Rigid.", "Hyperactive."], answer: 2, rationale: "Peritonitis." },
        { q: "Hep A spread:", options: ["Blood.", "Sex.", "Food/Water.", "Autoimmune."], answer: 2, rationale: "Fecal-oral." },
        { q: "Pancreatitis glucose:", options: ["Candy.", "Islets damage.", "Liver.", "Kidney."], answer: 1, rationale: "Insulin." },
        { q: "GERD avoid:", options: ["Oatmeal.", "Chocolate.", "Apple.", "Chicken."], answer: 1, rationale: "LES relax." },
        { q: "Clay stool:", options: ["Kidney.", "Stomach.", "Biliary block.", "Colon."], answer: 2, rationale: "No bile." },
        { q: "Hiatal hernia:", options: ["Lie down.", "Binder.", "No lifting.", "Big meals."], answer: 2, rationale: "Pressure." },
        { q: "Fecal emesis:", options: ["Low obstruction.", "Hygiene.", "Cancer.", "Ulcer."], answer: 0, rationale: "Backflow." },
        { q: "Protein IBD vs Cirrhosis:", options: ["Constipation.", "Healing vs Ammonia.", "Ulcer.", "Allergy."], answer: 1, rationale: "Detox issue." },
        { q: "Cholecystitis NPO:", options: ["Aspiration.", "Stop contraction.", "Diarrhea.", "Prep."], answer: 1, rationale: "Pain." },
        { q: "Barrett's Esophagus:", options: ["Stricture.", "Precancerous.", "Abscess.", "Tear."], answer: 1, rationale: "Metaplasia." },
        { q: "Sucralfate:", options: ["Meal.", "1hr Before.", "After.", "PRN."], answer: 1, rationale: "Coats." },
        { q: "Coffee ground emesis:", options: ["Hematochezia.", "Melena.", "Hematemesis.", "Steatorrhea."], answer: 2, rationale: "Digested blood." },
        { q: "Octreotide:", options: ["Neutralize.", "Insulin.", "Slow emptying.", "Coat."], answer: 2, rationale: "Dumping." },
        { q: "Gastric ulcer:", options: ["Weight gain.", "Food helps.", "Night.", "Food hurts."], answer: 3, rationale: "Acid." },
        { q: "NSAID ulcer:", options: ["H pylori.", "Prostaglandins.", "Acid.", "LES."], answer: 1, rationale: "Barrier." },
        { q: "Dumping diet:", options: ["Pancake.", "Protein/Veg.", "Pasta.", "Ice cream."], answer: 1, rationale: "Low carb." },
        { q: "Appendicitis WBC:", options: ["Sepsis.", "Leukocytosis.", "Normal.", "Viral."], answer: 1, rationale: "Infection." },
        { q: "Obturator sign:", options: ["Extend.", "Rotate flexed.", "Palp.", "Cough."], answer: 1, rationale: "Check." },
        { q: "Peritonitis pos:", options: ["Semi-Fowler.", "Sores.", "Pain.", "Heart."], answer: 0, rationale: "Drainage." },
        { q: "Diverticulosis prev:", options: ["Low res.", "High fiber.", "Abx.", "Rest."], answer: 1, rationale: "Constipation." },
        { q: "Diverticulitis med:", options: ["Vanc.", "Metronidazole.", "Acyclovir.", "Prednisone."], answer: 1, rationale: "Anaerobes." },
        { q: "Appy heat pad:", options: ["Mask.", "Rupture.", "Burn.", "Spasm."], answer: 1, rationale: "Flow." },
        { q: "Transmural IBD:", options: ["UC.", "Crohn's.", "Div.", "IBS."], answer: 1, rationale: "Deep." },
        { q: "Steatorrhea:", options: ["Bleed.", "Malabsorption.", "Bile.", "Empty."], answer: 1, rationale: "Fat." },
        { q: "UC cure:", options: ["Resection.", "Proctocolectomy.", "Appy.", "Nissen."], answer: 1, rationale: "Removal." },
        { q: "Steroid risk:", options: ["Low sugar.", "Weight loss.", "Infection.", "Low BP."], answer: 2, rationale: "Immunity." },
        { q: "Smoking Crohn's:", options: ["Good.", "None.", "Bad.", "Lung."], answer: 2, rationale: "Risk." },
        { q: "Fistula:", options: ["Telescope.", "Tunnel.", "Block.", "Vein."], answer: 1, rationale: "Connection." },
        { q: "Volvulus:", options: ["Twist.", "Telescope.", "Tumor.", "Still."], answer: 0, rationale: "Twist." },
        { q: "NG stopped:", options: ["Remove.", "Irrigate.", "Notify.", "Suction."], answer: 1, rationale: "Clog." },
        { q: "High obstruction acid:", options: ["Bicarb.", "Met Alk.", "CO2.", "Renal."], answer: 1, rationale: "Acid loss." },
        { q: "Adhesiolysis:", options: ["Tumor.", "Scar tissue.", "Tube.", "Appy."], answer: 1, rationale: "Adhesions." },
        { q: "Post-hemorrhoid faint:", options: ["Constipation.", "Internal bleed.", "Gas.", "Drug."], answer: 1, rationale: "Rectal blood." },
        { q: "Tucks:", options: ["Lido.", "Witch Hazel.", "Steroid.", "Menthol."], answer: 1, rationale: "Cooling." },
        { q: "Hemorrhoid prev:", options: ["Enema.", "No sitting.", "Low res.", "Fluid restriction."], answer: 1, rationale: "Pressure." },
        { q: "Spider angioma:", options: ["Ammonia.", "Estrogen.", "HTN.", "Vit K."], answer: 1, rationale: " Hormones." },
        { q: "Cirrhosis drugs:", options: ["Kidney.", "Metabolism.", "Dry.", "Protein."], answer: 1, rationale: "Clearance." },
        { q: "Ascites breath:", options: ["O2.", "High Fowler.", "Tube.", "Side."], answer: 1, rationale: "Diaphragm." },
        { q: "Liver biopsy lab:", options: ["Anemia.", "PT/INR.", "Infection.", "Platelets."], answer: 1, rationale: "Clotting." },
        { q: "Encephalopathy sedative:", options: ["HTN.", "Metabolism/Coma.", "Ammonia.", "Lactulose."], answer: 1, rationale: "Worse." },
        { q: "ERCP check:", options: ["Urine.", "Gag.", "Pulse.", "Pupil."], answer: 1, rationale: "Airway." },
        { q: "Autodigestion:", options: ["Stomach.", "Pancreas.", "Liver.", "Bac."], answer: 1, rationale: "Enzymes." },
        { q: "Hypocalcemia sign:", options: ["Chvostek.", "Murphy.", "McBurney.", "Cullen."], answer: 0, rationale: "Twitch." },
        { q: "Morphine pancreatitis:", options: ["No.", "Yes.", "Fever.", "Cure."], answer: 1, rationale: "Pain." },
        { q: "Clay stool:", options: ["Gallbladder.", "Obstruction.", "Bleed.", "Heal."], answer: 1, rationale: "No bile." },
        { q: "5 Fs:", options: ["Forty/Fat/Female.", "Fifty.", "Fit.", "Fever."], answer: 0, rationale: "Gallstones." },
        { q: "Low fat diet:", options: ["Constipation.", "Contraction.", "Acid.", "Liver."], answer: 1, rationale: "Pain prev." },
        { q: "Barium fluids:", options: ["Limit.", "Flush.", "Hot.", "No dairy."], answer: 1, rationale: "Cement." },
        { q: "Colonoscopy:", options: ["Rectum.", "Sigmoid.", "Cecum.", "Duodenum."], answer: 2, rationale: "Full." },
        { q: "Abd exam order:", options: ["Palp.", "Inspect/Palp.", "Inspect/Ausc/Perc/Palp.", "Ausc."], answer: 2, rationale: "Sound." },
        { q: "Tinkling:", options: ["Normal.", "Ileus.", "Obstruction.", "Peritonitis."], answer: 2, rationale: "Pushing." },
        { q: "O&P:", options: ["Blood.", "Parasite.", "Fat.", "Bac."], answer: 1, rationale: "Worms." },
        { q: "Ascaris:", options: ["Bac.", "Worm.", "Virus.", "Fungus."], answer: 1, rationale: "Parasite." },
        { q: "Icteric:", options: ["Flu.", "Jaundice.", "Recovery.", "Ascites."], answer: 1, rationale: "Yellow." },
        { q: "Fetor Hepaticus:", options: ["Breath.", "Tremor.", "Rash.", "Mind."], answer: 0, rationale: "Odor." },
        { q: "Atropine:", options: ["Bradycardia.", "Sedate.", "Vomit.", "Allergy."], answer: 0, rationale: "Vagal." },
        { q: "Rebound tend:", options: ["Gallbladder.", "Appy.", "Gastritis.", "Kidney."], answer: 1, rationale: "Peritonitis." },
        { q: "Hyperglycemia panc:", options: ["Meds.", "Insulin loss.", "Glucagon.", "Tabs."], answer: 1, rationale: "Islets." },
        { q: "Hep vaccines:", options: ["C/D.", "A/B.", "E/C.", "B."], answer: 1, rationale: "Prev." }
    ];

    // ================= APP LOGIC =================
    let activeDeck = [];
    let currentIdx = 0;
    let score = 0;
    let isAnswered = false;
    let userHistory = [];

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        window.scrollTo(0,0);
    }

    function showMenu() {
        showView('view-menu');
        document.getElementById('header-title').innerText = "NCLEX Ultimate V4";
        document.getElementById('topic-badge').innerText = "Menu";
        document.querySelector('header').style.background = "var(--primary)";
    }

    function startQuiz(topic) {
        // Clone Data
        let sourceDeck = (topic === 'gi') ? [...giQuestions] : [...psychQuestions];
        const themeColor = (topic === 'gi') ? "var(--secondary)" : "var(--accent)";
        const title = (topic === 'gi') ? "GI Disorders" : "Psychiatric & Neuro";

        // RANDOMIZER LOGIC
        if (document.getElementById('randomize-toggle').checked) {
            sourceDeck.sort(() => Math.random() - 0.5);
        }
        activeDeck = sourceDeck;
        
        // UI Setup
        document.getElementById('header-title').innerText = title;
        document.getElementById('topic-badge').innerText = "Quiz Active";
        document.querySelector('header').style.background = themeColor;

        // Reset
        currentIdx = 0;
        score = 0;
        userHistory = [];
        showView('view-quiz');
        loadQuestion();
    }

    function loadQuestion() {
        isAnswered = false;
        const qData = activeDeck[currentIdx];
        
        document.getElementById('q-current').innerText = currentIdx + 1;
        document.getElementById('q-total').innerText = activeDeck.length;
        document.getElementById('score-tracker').innerText = `Score: ${score}`;
        document.getElementById('question-text').innerText = qData.q;
        
        const pct = ((currentIdx) / activeDeck.length) * 100;
        document.getElementById('progress-fill').style.width = pct + '%';
        
        document.getElementById('rationale-display').style.display = 'none';
        document.getElementById('btn-next').style.display = 'none';
        
        const optContainer = document.getElementById('options-container');
        optContainer.innerHTML = '';
        
        qData.options.forEach((optText, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = optText;
            btn.onclick = () => handleAnswer(index, btn);
            optContainer.appendChild(btn);
        });
    }

    function handleAnswer(selectedIndex, btnElement) {
        if (isAnswered) return;
        isAnswered = true;

        const currentQ = activeDeck[currentIdx];
        const correctIndex = currentQ.answer;
        const isCorrect = (selectedIndex === correctIndex);
        
        const allBtns = document.getElementById('options-container').children;

        if (isCorrect) {
            btnElement.classList.add('correct');
            score++;
        } else {
            btnElement.classList.add('wrong');
            allBtns[correctIndex].classList.add('correct');
        }

        userHistory.push({
            q: currentQ.q,
            user: currentQ.options[selectedIndex],
            correct: currentQ.options[correctIndex],
            isCorrect: isCorrect,
            rationale: currentQ.rationale
        });

        document.getElementById('rationale-text').innerText = currentQ.rationale;
        document.getElementById('rationale-display').style.display = 'block';
        document.getElementById('btn-next').style.display = 'inline-block';
        document.getElementById('score-tracker').innerText = `Score: ${score}`;

        for (let btn of allBtns) btn.disabled = true;
    }

    function nextQuestion() {
        currentIdx++;
        if (currentIdx < activeDeck.length) {
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    function finishQuiz() {
        showView('view-results');
        
        const finalPct = Math.round((score / activeDeck.length) * 100);
        document.getElementById('final-score').innerText = finalPct;
        document.getElementById('final-stats').innerText = `You answered ${score} out of ${activeDeck.length} correctly.`;
        
        const rundown = document.getElementById('rundown-container');
        rundown.innerHTML = '';

        userHistory.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = `rundown-item ${item.isCorrect ? 'correct' : 'wrong'}`;
            div.innerHTML = `
                <span class="rundown-q">Q${index + 1}: ${item.q}</span>
                <div style="font-size:0.9rem;">
                    Your Answer: <strong>${item.user}</strong> ${item.isCorrect ? '‚úÖ' : '‚ùå'}
                </div>
                ${!item.isCorrect ? `
                <div style="font-size:0.9rem; color:var(--success);">
                    Correct Answer: <strong>${item.correct}</strong>
                </div>` : ''}
                <div style="margin-top:8px; font-size:0.85rem; color:#666; background:#f9f9f9; padding:8px; border-radius:4px;">
                    <strong>Rationale:</strong> ${item.rationale}
                </div>
            `;
            rundown.appendChild(div);
        });
    }
</script>
</body>
</html>
